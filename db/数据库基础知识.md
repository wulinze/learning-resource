### 数据库基础知识

#### ACID(事务的基本性质)

* **Atomicity 原子性**

  要么都做要么都不做

* **Consistency 一致性**

  解释起来较为复杂，要注意和CAP分开

  包括各种基本的约束，以及事务处理前后数据的一致性，处理前的状态是一致的处理后也是一致的

* **Isolation 隔离性**

  不同事务之间是不可见的，互相不影响

* **Durability 持久性**

  一旦提交永久保存

#### 隔离级别

包括基本的基于2PL提出的4个隔离级别和后续基于快照的隔离级别

**隔离级别代表了事务并发时候活跃事务之间的隔离性问题**

* 读未提交：出现**脏读**，读到一个没有提交事务的中间结果

* 读提交：出现**不可重复读**，只读取提交之后的结果，可能导致两次读取结果不同。

* 可重复读：出现**幻读**，对于某些特殊的查询，查询到的集合的数量是不一致的。

* 串行化：对于事务并发时对于读写集进行排序，串行化的进行读写。

* 快照隔离级别(SI)

  不会发生**脏读，不可重复读和幻读**。因为是基于快照进行读取，之后进行写入，可能会发生**Write Skew(写偏斜)**

  其典型示例如下所示：

  ~~~
  考虑两个事务P和Q。
  
  P将寄存器x中的值复制到y，
  
  Q将寄存器中的值从y复制到x。
  
  只有两个串行执行：P，Q或者Q，P。无论哪种方式，最终结果都是x = y。
  
  但是，快照隔离允许另一个结果：
  
  事务P读取x
  事务Q读取y
  事务P将其读取的值写入y
  事务Q将其读取的值写入x
  ~~~

* 可串行化快照隔离级别(SSI)

#### 数据库日志(WAL)

* **redo log：幂等性**
* **undo log**
* **steal策略**：steal允许uncommitted的事务写入磁盘，数据库恢复时需要undo log
* **force策略**：force要求committed的事务必须立刻写入磁盘，需要unforce 需要redo log

#### 数据库常用树结构

* **Btree**
* **B+tree**
* **Blinktree**
* **Massree**
* **LSMtree**

#### 死锁预防

* **受伤等待：**非抢占式，允许高优先级等待，低优先级遇到等待直接回滚
* **等待死亡：**抢占式，高优先级直接抢占低优先级，抢占之后低优先级回滚

